<style type="text/css">
.title {
  font-size: 18px;
  line-height: 27px;
  font-weight: bold;
  margin: 0;
  display:block;
}
#btn-refresh, #btn-view-all {
  float:right;
}

.maildate, .mailtime {
  float:right;
  margin-left:5px;
}

div.usage {
  color: #0088CC;
  margin:10px;
}

div.usage a {
  color: black;
  font-weight:bold;
}

</style>

<script type="text/javascript">
  // Lightbox on picture link
  $(function() {
  	$('a.thumbnail').lightBox(); 
  });
  
  // Refreshing Gps Trace
  function reloadIframe() {
  	$( 'div#carte iframe' ).attr( 'src', function ( i, val ) { return val; });
  }
  
  // Show all mail history
  function showAllMails(b) {
    $('div#history').toggle();
     if ($('div#history').css('display') == 'none') {
          $('#btn-view-all').html('<i class="icon-th-list"></i>&nbsp;Tout voir &#9658');
     }
     else {
          $('#btn-view-all').html('<i class="icon-th-list"></i>&nbsp;Masquer &#9660');
          ajaxLoadAllMails();
     }  };
  
  // loading all mails in ajax
  function ajaxLoadAllMails() {
    alert ('Wait... loading mails data...');
  }
    
</script>

<!-- last mail -->
<div class="row">
  <?r if !@mail.mailimagefile.nil? ?>
    <a class="thumbnail span3" href="pictures/#{@mail.mailimagefile}">
      <img src="pictures/#{@mail.mailimagefile}" width="260" height="180"/>
    </a>
  <?r end ?>
  
    <p class="span12 well">
      <!-- date & time -->
      <em class="label label-success mailtime">#{@mail.mailtime}</em>
      <em class="label label-warning maildate">#{@mail.maildate}</em>
      <!-- subject, text -->
      <span class="title">#{@mail.mailsubject}</span>
      <br>
      #{@mail.mailtext}
      <a id="btn-view-all" class="offset9 btn btn-default" href="javascript:showAllMails();"><i class="icon-th-list"></i>&nbsp;Tout voir &#9658</a>
    </p>
</div>
    
<!-- mail history -->
<div id="history" class="row hide">
showing mail history...
</div>

<!-- separator -->
<div class="row">&nbsp;</div>

<!-- map -->
<div class="row">
  <div id="carte" class="span12 well">
    <!-- BEGIN INSTAMAPPER CODE -->
    <iframe width="100%" scrolling="no" height="568" frameborder="0" src="http://www.instamapper.com/ext?key=#{MYCONF[:instantmapper_key]}&width=800&height=500&zoom=11&type=roadmap&units=metric&coords=dms&num_points=1000" style="border:1px solid;"></iframe>
    GPS tracking powered by <a href="http://www.instamapper.com">InstaMapper.com</a><br />
    <a id="btn-refresh" class="offset9 btn btn-inverse" href="javascript:reloadIframe();"><i class="icon-refresh icon-white"></i>&nbsp;recharger la carte</a>
  </div>
  
  <!-- twitter flow -->
  <div id="filtwitter" class="span3 well" style="padding-left:0px;width:247px;">
  <script src="http://widgets.twimg.com/j/2/widget.js"></script>
  <script>
  // http://www.1stwebdesigner.com/css/customize-twitter-search-widgets/
  
  new TWTR.Widget({
      version: 2,
      type: 'search', //'profile', 'list'
      search: 'from:#{MYCONF[:twitter_account]} OR #{MYCONF[:twitter_hashtag1]}', 
      rpp: 100,
      interval: 3000,
      title: '#{MYCONF[:twitter_title]}',
      subject: '#{MYCONF[:twitter_subject]}',
      width: 265,
      height: 500,
      
      theme: {
          shell: {
              background: 'transparent', 
              color: '0088cc'
          },
          tweets: {
              background: 'transparent', 
              color: '#D21A00',
              links: '#4A412E'
          }
      },
      
      features: {
          scrollbar: true,
          loop: true,
          live: false,
          hashtags: true,
          timestamp: true,
          avatars: true,
          toptweets: true,
          behavior: 'default', //'all'
      },
      ready: function() {
          // when done rendering...
          // Démarrer le timer !
      }
      
  }).render().start();
  </script>
  <style>
  .twtr-widget h3 { font-weight:13px !important;}
  </style>
  </div>
</div>

<div class="row">
  <div class="well usage">
    Utilisez le hashtag <a href="https://twitter.com/#{MYCONF[:twitter_hashtag1]}" target="_blank">#{MYCONF[:twitter_hashtag1]}</a> pour nous envoyer des réponses dans ce flux.
  </div>
</div>
